sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","com/sap/notifications/banner2/model/formatter"],function(e,t,a,r,s){"use strict";return e.extend("com.sap.notifications.banner2.controller.View1",{formatter:s,onInit:function(){var e=new t({messages:[],busy:false});this.getView().setModel(e);var a=new t({dialogTitle:"",message_id:"",title:"",message_text:"",severity:"MEDIUM",message_type:"INFO",display_mode:"BANNER",target_audience:"ALL",start_date:this._getFormattedDate(new Date),end_date:this._getFormattedDate(new Date(Date.now()+30*24*60*60*1e3)),active:true});this.getView().setModel(a,"editMode");this.onRefresh()},onRefresh:function(){var e=this;var t=this.getView().getModel();t.setProperty("/busy",true);jQuery.ajax({url:"/sap/bc/rest/zcl_notif_rest/",type:"GET",data:{all:"X"},timeout:1e4,success:function(e){t.setProperty("/busy",false);var r=Array.isArray(e)?e:e.d||e;r.forEach(function(e){e.active=e.active==="X"||e.active===true});t.setProperty("/messages",r);a.show("Loaded "+r.length+" notifications")},error:function(a,s,i){t.setProperty("/busy",false);r.error(e.getView().getModel("i18n").getProperty("msgLoadError")+"\nStatus: "+a.status+"\n"+i)}})},onCreate:function(){var e=this.getView().getModel("editMode");var t=this.getView().getModel("i18n");e.setData({dialogTitle:t.getProperty("buttonCreate"),message_id:"",title:"",message_text:"",severity:"MEDIUM",message_type:"INFO",display_mode:"BANNER",target_audience:"ALL",start_date:this._getFormattedDate(new Date),end_date:this._getFormattedDate(new Date(Date.now()+30*24*60*60*1e3)),active:true});this._getDialog().open()},onEdit:function(e){var t=e.getSource().getBindingContext();var a=t.getObject();var r=this.getView().getModel("editMode");var s=this.getView().getModel("i18n");r.setData({dialogTitle:s.getProperty("buttonEdit"),message_id:a.message_id,title:a.title,message_text:a.message_text,severity:a.severity,message_type:a.message_type,display_mode:a.display_mode,target_audience:a.target_audience,start_date:a.start_date,end_date:a.end_date,active:a.active});this._getDialog().open()},onSave:function(){var e=this;var t=this.getView().getModel("editMode").getData();var s=this.getView().getModel("i18n");if(!this._validateMessage(t)){r.error(s.getProperty("messageValidationError"));return}var i={message_id:t.message_id||this._generateUUID(),title:t.title,message_text:t.message_text,severity:t.severity,message_type:t.message_type,display_mode:t.display_mode,target_audience:t.target_audience,start_date:t.start_date,end_date:t.end_date,active:t.active?"X":""};var n=!!t.message_id&&t.message_id.length>0;var o=n?"PUT":"POST";var g="/sap/bc/rest/zcl_notif_rest/";if(n){g+="?message_id="+encodeURIComponent(i.message_id)}jQuery.ajax({url:g,type:o,contentType:"application/json",data:JSON.stringify(i),timeout:1e4,success:function(){e._getDialog().close();a.show(n?s.getProperty("messageUpdateSuccess"):s.getProperty("messageCreateSuccess"));e.onRefresh()},error:function(e,t,a){r.error(s.getProperty("msgSaveError")+"\nStatus: "+e.status+"\n"+a)}})},onDelete:function(e){var t=this;var s=e.getSource().getBindingContext();var i=s.getObject();var n=this.getView().getModel("i18n");r.confirm(n.getProperty("msgDeleteConfirm"),{title:n.getProperty("msgDeleteConfirmTitle"),onClose:function(e){if(e===r.Action.OK){jQuery.ajax({url:"/sap/bc/rest/zcl_notif_rest/?message_id="+encodeURIComponent(i.message_id),type:"DELETE",timeout:1e4,success:function(){a.show(n.getProperty("messageDeleteSuccess"));t.onRefresh()},error:function(e,t,a){r.error(n.getProperty("msgDeleteError")+"\nStatus: "+e.status+"\n"+a)}})}}})},onToggleActive:function(e){var t=this;var s=e.getParameter("state");var i=e.getSource().getBindingContext();var n=i.getObject();var o=this.getView().getModel("i18n");n.active=s?"X":"";jQuery.ajax({url:"/sap/bc/rest/zcl_notif_rest/?message_id="+encodeURIComponent(n.message_id),type:"PUT",contentType:"application/json",data:JSON.stringify(n),timeout:1e4,success:function(){a.show(s?o.getProperty("msgActivateSuccess"):o.getProperty("msgDeactivateSuccess"));t.onRefresh()},error:function(t,a,i){r.error(o.getProperty("msgSaveError")+"\nStatus: "+t.status+"\n"+i);e.getSource().setState(!s)}})},onSearch:function(e){var t=e.getParameter("query")||e.getParameter("newValue");var a=this.byId("messagesTable");var r=a.getBinding("items");if(r){var s=[];if(t&&t.length>0){s.push(new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("title",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("message_text",sap.ui.model.FilterOperator.Contains,t)],and:false}))}r.filter(s)}},onFilterChange:function(){var e=this.byId("messagesTable");var t=e.getBinding("items");var a=this.byId("filterActiveOnly").getSelected();var r=this.byId("filterSeverity").getSelectedKey();if(t){var s=[];if(a){s.push(new sap.ui.model.Filter("active",sap.ui.model.FilterOperator.EQ,true))}if(r){s.push(new sap.ui.model.Filter("severity",sap.ui.model.FilterOperator.EQ,r))}t.filter(s)}},onCancelDialog:function(){this._getDialog().close()},onDateChange:function(){var e=this.getView().getModel("editMode").getData();var t=new Date(e.start_date);var r=new Date(e.end_date);if(r<t){a.show(this.getView().getModel("i18n").getProperty("validationEndDateInvalid"))}},_getDialog:function(){if(!this._oDialog){this._oDialog=this.byId("messageDialog")}return this._oDialog},_validateMessage:function(e){if(!e.title||e.title.trim().length===0){return false}if(!e.message_text||e.message_text.trim().length===0){return false}if(!e.start_date){return false}if(!e.end_date){return false}var t=new Date(e.start_date);var a=new Date(e.end_date);if(a<t){return false}return true},_generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0;var a=e==="x"?t:t&3|8;return a.toString(16)})},_getFormattedDate:function(e){var t=e.getFullYear();var a=String(e.getMonth()+1).padStart(2,"0");var r=String(e.getDate()).padStart(2,"0");return t+"-"+a+"-"+r}})});
//# sourceMappingURL=View1.controller.js.map