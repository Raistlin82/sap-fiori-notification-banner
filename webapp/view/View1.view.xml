<mvc:View
    controllerName="com.sap.notifications.banner2.controller.View1"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    xmlns:l="sap.ui.layout"
    displayBlock="true"
    xmlns="sap.m">

    <Page id="page"
          title="{i18n>adminPageTitle}"
          showNavButton="false"
          class="sapUiResponsiveContentPadding">

        <headerContent>
            <Button
                id="refreshButton"
                icon="sap-icon://refresh"
                text="{i18n>buttonRefresh}"
                press=".onRefresh"
                tooltip="{i18n>buttonRefresh}"/>
            <Button
                id="createButton"
                icon="sap-icon://add"
                text="{i18n>buttonCreate}"
                type="Emphasized"
                press=".onCreate"/>
        </headerContent>

        <subHeader>
            <Toolbar>
                <Title text="{i18n>adminPageSubtitle}" level="H2"/>
                <ToolbarSpacer/>
                <SearchField
                    id="searchField"
                    width="300px"
                    placeholder="Search notifications..."
                    search=".onSearch"/>
            </Toolbar>
        </subHeader>

        <content>

            <!-- Filter Bar -->
            <VBox class="sapUiSmallMarginBottom">
                <Toolbar>
                    <Title text="{i18n>filterBarTitle}"/>
                    <ToolbarSpacer/>
                    <Select
                        id="filterActive"
                        width="150px"
                        selectedKey=""
                        change=".onFilterChange">
                        <items>
                            <core:Item key="" text="All Notifications"/>
                            <core:Item key="active" text="Active Only"/>
                            <core:Item key="inactive" text="Inactive Only"/>
                        </items>
                    </Select>
                    <Select
                        id="filterSeverity"
                        width="150px"
                        change=".onFilterChange">
                        <items>
                            <core:Item key="" text="All Severities"/>
                            <core:Item key="HIGH" text="{i18n>severityHigh}"/>
                            <core:Item key="MEDIUM" text="{i18n>severityMedium}"/>
                            <core:Item key="LOW" text="{i18n>severityLow}"/>
                        </items>
                    </Select>
                </Toolbar>
            </VBox>

            <!-- Messages Table -->
            <Table
                id="messagesTable"
                items="{/messages}"
                mode="None"
                noDataText="{i18n>msgNoData}"
                class="sapUiResponsiveMargin"
                fixedLayout="false">

                <columns>
                    <Column width="60px">
                        <Text text="{i18n>columnSeverity}"/>
                    </Column>
                    <Column width="200px" minScreenWidth="Tablet" demandPopin="true">
                        <Text text="{i18n>columnTitle}"/>
                    </Column>
                    <Column width="35%" minScreenWidth="Desktop" demandPopin="true" hAlign="Begin">
                        <Text text="{i18n>columnMessage}"/>
                    </Column>
                    <Column width="200px" minScreenWidth="Desktop" demandPopin="true">
                        <Text text="{i18n>columnPeriod}"/>
                    </Column>
                    <Column width="130px" minScreenWidth="Desktop" demandPopin="true">
                        <Text text="{i18n>columnTargetAudience}"/>
                    </Column>
                    <Column width="130px" minScreenWidth="Tablet" demandPopin="true">
                        <Text text="{i18n>columnDisplayMode}"/>
                    </Column>
                    <Column width="120px" minScreenWidth="Tablet" demandPopin="true" hAlign="Center">
                        <Text text="{i18n>columnStatus}"/>
                    </Column>
                    <Column width="180px">
                        <Text text="{i18n>columnActions}"/>
                    </Column>
                </columns>

                <items>
                    <ColumnListItem>
                        <cells>
                            <!-- Severity -->
                            <ObjectStatus
                                state="{
                                    path: 'severity',
                                    formatter: '.formatter.formatSeverityState'
                                }"
                                icon="{
                                    path: 'severity',
                                    formatter: '.formatter.formatSeverityIcon'
                                }"/>

                            <!-- Title -->
                            <VBox>
                                <Text text="{title}" class="sapUiTinyMarginBottom"/>
                                <ObjectStatus
                                    text="{message_type}"
                                    state="Information"/>
                            </VBox>

                            <!-- Message -->
                            <Text
                                text="{message_text}"
                                maxLines="3"
                                wrapping="true"/>

                            <!-- Period (Date Range) -->
                            <Text
                                text="{
                                    parts: ['start_date', 'end_date'],
                                    formatter: '.formatter.formatDateRange'
                                }"
                                wrapping="false"/>

                            <!-- Target Users -->
                            <Text text="{target_users}"/>

                            <!-- Display Mode -->
                            <Text text="{display_mode}"/>

                            <!-- Status -->
                            <Switch
                                state="{active}"
                                customTextOn="Active"
                                customTextOff="Inactive"
                                change=".onToggleActive"/>

                            <!-- Actions -->
                            <HBox>
                                <Button
                                    icon="sap-icon://display"
                                    type="Transparent"
                                    press=".onView"
                                    tooltip="View"/>
                                <Button
                                    icon="sap-icon://edit"
                                    type="Transparent"
                                    press=".onEdit"
                                    tooltip="{i18n>buttonEdit}"/>
                                <Button
                                    icon="sap-icon://copy"
                                    type="Transparent"
                                    press=".onCopy"
                                    tooltip="Copy"/>
                                <Button
                                    icon="sap-icon://delete"
                                    type="Transparent"
                                    press=".onDelete"
                                    tooltip="{i18n>buttonDelete}"/>
                            </HBox>
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>

        </content>

    </Page>

    <!-- Create/Edit/View Dialog -->
    <Dialog
        id="messageDialog"
        title="{editMode>/dialogTitle}"
        contentWidth="600px"
        contentHeight="600px"
        draggable="true"
        resizable="true">

        <content>
            <f:SimpleForm
                id="messageForm"
                editable="{= !${editMode>/isViewMode} }"
                layout="ResponsiveGridLayout"
                labelSpanXL="4"
                labelSpanL="4"
                labelSpanM="12"
                labelSpanS="12"
                adjustLabelSpan="false"
                emptySpanXL="0"
                emptySpanL="0"
                emptySpanM="0"
                emptySpanS="0"
                columnsXL="1"
                columnsL="1"
                columnsM="1"
                singleContainerFullSize="true">

                <f:content>

                    <!-- STEP 1: Title and Message (always visible in create mode) -->
                    <Label text="{i18n>fieldTitle}" required="true"/>
                    <Input
                        id="inputTitle"
                        value="{editMode>/title}"
                        placeholder="Enter notification title"
                        required="true"
                        maxLength="100"
                        enabled="{= !${editMode>/isViewMode} }"/>

                    <!-- Message Text -->
                    <Label text="{i18n>fieldMessage}" required="true"/>
                    <TextArea
                        id="inputMessage"
                        value="{editMode>/message_text}"
                        rows="4"
                        placeholder="Enter notification message"
                        required="true"
                        maxLength="255"
                        enabled="{= !${editMode>/isViewMode} }"/>

                    <!-- STEP 2: Severity (visible from step 2 onwards OR in edit/view mode) -->
                    <Label text="{i18n>fieldSeverity}" required="true"
                           visible="{= ${editMode>/currentStep} >= 2 || !!${editMode>/message_id} }"/>
                    <Select
                        id="selectSeverity"
                        selectedKey="{editMode>/severity}"
                        required="true"
                        visible="{= ${editMode>/currentStep} >= 2 || !!${editMode>/message_id} }"
                        enabled="{= !${editMode>/isViewMode} }">
                        <items>
                            <core:Item key="HIGH" text="{i18n>severityHigh}"/>
                            <core:Item key="MEDIUM" text="{i18n>severityMedium}"/>
                            <core:Item key="LOW" text="{i18n>severityLow}"/>
                        </items>
                    </Select>

                    <!-- STEP 3: Message Type (visible from step 3 onwards OR in edit/view mode) -->
                    <Label text="{i18n>fieldMessageType}" required="true"
                           visible="{= ${editMode>/currentStep} >= 3 || !!${editMode>/message_id} }"/>
                    <Select
                        id="selectMessageType"
                        selectedKey="{editMode>/message_type}"
                        required="true"
                        visible="{= ${editMode>/currentStep} >= 3 || !!${editMode>/message_id} }"
                        enabled="{= !${editMode>/isViewMode} }">
                        <items>
                            <core:Item key="URGENT" text="{i18n>messageTypeUrgent}"/>
                            <core:Item key="INFO" text="{i18n>messageTypeInfo}"/>
                            <core:Item key="TIP" text="{i18n>messageTypeTip}"/>
                            <core:Item key="WARNING" text="{i18n>messageTypeWarning}"/>
                            <core:Item key="MAINT" text="{i18n>messageTypeMaint}"/>
                        </items>
                    </Select>

                    <!-- STEP 4: Display Mode (visible from step 4 onwards OR in edit/view mode) -->
                    <Label text="{i18n>fieldDisplayMode}" required="true"
                           visible="{= ${editMode>/currentStep} >= 4 || !!${editMode>/message_id} }"/>
                    <Select
                        id="selectDisplayMode"
                        selectedKey="{editMode>/display_mode}"
                        required="true"
                        visible="{= ${editMode>/currentStep} >= 4 || !!${editMode>/message_id} }"
                        enabled="{= !${editMode>/isViewMode} }">
                        <items>
                            <core:Item key="BANNER" text="{i18n>displayModeBanner}"/>
                            <core:Item key="TOAST" text="{i18n>displayModeToast}"/>
                            <core:Item key="BOTH" text="{i18n>displayModeBoth}"/>
                            <core:Item key="SILENT" text="{i18n>displayModeSilent}"/>
                        </items>
                    </Select>

                    <!-- STEP 5: Remaining fields (visible from step 5 onwards OR in edit/view mode) -->
                    <!-- Target Audience -->
                    <Label text="{i18n>fieldTargetUsers}" required="true"
                           visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }"/>
                    <Select
                        id="selectTargetUsers"
                        selectedKey="{editMode>/target_audience}"
                        required="true"
                        visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }"
                        enabled="{= !${editMode>/isViewMode} }">
                        <items>
                            <core:Item key="ALL" text="{i18n>targetUsersAll}"/>
                            <core:Item key="ADMIN" text="{i18n>targetUsersAdmin}"/>
                            <core:Item key="DEVELOPER" text="{i18n>targetUsersDeveloper}"/>
                        </items>
                    </Select>

                    <!-- Start Date -->
                    <Label text="{i18n>fieldStartDate}" required="true"
                           visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }"/>
                    <DatePicker
                        id="inputStartDate"
                        value="{editMode>/start_date}"
                        valueFormat="yyyy-MM-dd"
                        displayFormat="dd/MM/yyyy"
                        required="true"
                        visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }"
                        change=".onDateChange"
                        enabled="{= !${editMode>/isViewMode} }"/>

                    <!-- End Date -->
                    <Label text="{i18n>fieldEndDate}" required="true"
                           visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }"/>
                    <DatePicker
                        id="inputEndDate"
                        value="{editMode>/end_date}"
                        valueFormat="yyyy-MM-dd"
                        displayFormat="dd/MM/yyyy"
                        required="true"
                        visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }"
                        change=".onDateChange"
                        enabled="{= !${editMode>/isViewMode} }"/>

                    <!-- Recurring Notifications Section (visible from step 5 onwards OR in edit/view mode) -->
                    <Label text="Recurring Notifications"
                           visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }"/>
                    <VBox visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }">
                        <CheckBox
                            id="checkBoxRecurring"
                            text="Create Recurring Notifications"
                            selected="{editMode>/isRecurring}"
                            select=".onRecurringToggle"
                            enabled="{= !${editMode>/isViewMode} &amp;&amp; !!${editMode>/canEnableRecurring} }"/>

                        <VBox visible="{editMode>/isRecurring}" class="sapUiSmallMarginTop sapUiSmallMarginBegin">
                            <HBox alignItems="Center">
                                <Label text="Recurrence Type:" class="sapUiTinyMarginEnd"/>
                                <Select
                                    id="selectRecurrenceType"
                                    selectedKey="{editMode>/recurrenceType}"
                                    width="150px"
                                    change=".onRecurringChange"
                                    enabled="{= !${editMode>/isViewMode} }">
                                    <items>
                                        <core:Item key="D" text="Daily"/>
                                        <core:Item key="W" text="Weekly"/>
                                        <core:Item key="M" text="Monthly"/>
                                    </items>
                                </Select>
                            </HBox>

                            <HBox alignItems="Center" class="sapUiTinyMarginTop">
                                <Label text="Number of Occurrences:" class="sapUiTinyMarginEnd"/>
                                <Input
                                    id="inputOccurrences"
                                    value="{editMode>/occurrences}"
                                    type="Number"
                                    width="100px"
                                    placeholder="e.g., 12"
                                    change=".onRecurringChange"
                                    enabled="{= !${editMode>/isViewMode} }"/>
                            </HBox>

                            <Text
                                text="{editMode>/recurringPreview}"
                                class="sapUiTinyMarginTop"
                                visible="{= ${editMode>/recurringPreview} !== '' }"/>
                        </VBox>
                    </VBox>

                    <!-- Active Status (visible from step 5 onwards OR in edit/view mode) -->
                    <Label text="{i18n>fieldActive}"
                           visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }"/>
                    <Switch
                        id="switchActive"
                        state="{editMode>/active}"
                        customTextOn="Active"
                        customTextOff="Inactive"
                        visible="{= ${editMode>/currentStep} >= 5 || !!${editMode>/message_id} }"
                        enabled="{= !${editMode>/isViewMode} }"/>

                </f:content>
            </f:SimpleForm>
        </content>

        <buttons>
            <Button
                text="Back"
                icon="sap-icon://nav-back"
                press=".onPreviousStep"
                visible="{editMode>/showBackButton}"/>
            <Button
                text="Forward"
                icon="sap-icon://navigation-right-arrow"
                iconFirst="false"
                type="Emphasized"
                press=".onNextStep"
                visible="{editMode>/showForwardButton}"/>
            <Button
                text="{i18n>buttonSave}"
                type="Emphasized"
                press=".onSave"
                visible="{editMode>/showSaveButton}"/>
            <Button
                text="{= ${editMode>/isViewMode} ? 'Close' : ${i18n>buttonCancel} }"
                press=".onCancelDialog"/>
        </buttons>

    </Dialog>

</mvc:View>
